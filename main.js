(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-27",headers:{authorization:"df089792-a67d-41d5-b354-4cd03174c768","Content-Type":"application/json"}},e=[fetch(t.baseUrl+"/users/me",{headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)})),fetch(t.baseUrl+"/cards",{headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))];function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e,o){return(e=function(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var o=e.call(t,"string");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var r=document.querySelector("#card-template").content;function c(t,e,n,c,i){var a=r.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__image"),s=a.querySelector(".card__title"),l=a.querySelector(".card__delete-button"),d=a.querySelector(".card__like"),f=d.querySelector(".card__like-button"),p=d.querySelector(".card__like-count");!function(t,e,n){n!==e&&t.remove()}(l,i,t.owner._id),function(t,e){e&&t.classList.add("card__like-button_is-active")}(f,function(t,e){return t.likes.some((function(t){return t._id===e}))}(t,i));var m=o(o(o({},u.classList[0],n),f.classList[0],e),l.classList[0],c);return u.src=t.link,u.alt=t.name,s.textContent=t.name,p.textContent=t.likes.length,a.addEventListener("click",(function(e){var n,o=m[e.target.classList[0]];o&&o({event:e,cardObject:t,likeCount:p,isLiked:(n=f,n.classList.contains("card__like-button_is-active"))})})),a}function i(e){(function(e){return fetch(t.baseUrl+"/cards/".concat(e.cardObject._id),{method:"DELETE",headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))})(e).then((function(t){e.event.target.closest(".card").remove()}))}function a(e){var n=e.cardObject._id,o=e.isLiked,r=e.likeCount,c=e.event.target;o?function(e){return fetch(t.baseUrl+"/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(n).then((function(t){c.classList.remove("card__like-button_is-active"),r.textContent=t.likes.length})):function(e){return fetch(t.baseUrl+"/cards/likes/".concat(e),{method:"PUT",headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(n).then((function(t){c.classList.add("card__like-button_is-active"),r.textContent=t.likes.length}))}function u(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function s(t){var e=t.currentTarget;(t.target.classList.contains("popup__close")||e===t.target)&&d(e)}function l(t){"Escape"===t.key&&d(document.querySelector(".popup_is-opened"))}function d(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function f(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);!function(t,e,n){t.forEach((function(t){m(p(t.id),e,t,n)}))}(n,e.errorClass,e.inputErrorClass),_(o,e.inactiveButtonClass)}function p(t){return document.querySelector(".".concat(t,"-error"))}function m(t,e,n,o){n.classList.remove(o),t.classList.remove(e),t.textContent=""}function _(t,e){t.classList.add(e),t.disabled=!0}document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("click",s)}));var v,h=document.querySelector(".places__list"),y=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_new-card"),g=document.querySelector(".popup_type_image"),L=document.querySelector(".popup_type_avatar"),q=document.forms["new-place"],C=q["place-name"],E=q.link,j=document.forms["edit-profile"],x=j.name,P=j.description,z=document.forms.avatar,w=z.link,U=document.querySelector(".profile"),A=U.querySelector(".profile__image"),T=U.querySelector(".profile__info"),O=T.querySelector(".profile__title"),B=T.querySelector(".profile__description"),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function N(t){u(g);var e=g.querySelector(".popup__image"),n=g.querySelector(".popup__caption");e.src=t.event.target.src,n.textContent=t.event.target.alt}function J(t,e){O.textContent=t,B.textContent=e}function M(t){J(t.name,t.about),A.style.backgroundImage="url(".concat(t.avatar,")")}y.addEventListener("click",(function(){u(S),x.value=O.textContent,P.value=B.textContent,f(j,D)})),b.addEventListener("click",(function(){u(k)})),A.addEventListener("click",(function(){u(L)})),j.addEventListener("submit",(function(e){var n,o;e.preventDefault(),(n=x.value,o=P.value,fetch(t.baseUrl+"/users/me",{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:o})}).then((function(t){if(t.ok)return t.json()})).catch((function(t){console.log(t)}))).then((function(t){J(t.name,t.about)})),d(S)})),q.addEventListener("submit",(function(e){e.preventDefault();var n,o,r=e.target.querySelector(".popup__button");r.textContent="Сохранение...",(n=C.value,o=E.value,fetch(t.baseUrl+"/cards",{method:"POST",headers:t.headers,body:JSON.stringify({name:n,link:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){h.prepend(c(t,a,N,i,t.owner._id)),r.textContent="Сохранить"})),q.reset(),f(q,D),d(k)})),z.addEventListener("submit",(function(e){e.preventDefault();var n,o=e.target.querySelector(".popup__button");o.textContent="Сохранение...",(n=w.value,fetch(t.baseUrl+"/users/me/avatar",{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){M(t),o.textContent="Сохранить"})),d(L),z.reset()})),v=D,Array.from(document.querySelectorAll(v.formSelector)).forEach((function(t){var e=Array.from(t.querySelectorAll(v.inputSelector)),n=t.querySelector(v.submitButtonSelector);e.forEach((function(t){t.addEventListener("input",(function(o){o.preventDefault(),function(t,e,n){var o=p(t.id),r=function(t){return t.validity.patternMismatch?t.dataset.invalidMessage:t.validationMessage}(t);t.validity.valid?m(o,n,t,e):function(t,e,n,o,r){o.classList.add(r),t.classList.add(n),t.textContent=e}(o,r,n,t,e)}(t,v.inputErrorClass,v.errorClass),function(t,e,n,o){var r=function(t,e){return!t.some((function(t){return t.classList.contains(e)}))}(e,o);r?function(t,e){t.classList.remove(e),t.disabled=!1}(t,n):_(t,n)}(n,e,v.inactiveButtonClass,v.inputErrorClass)}))}))})),Promise.all(e).then((function(t){var e,n,o=t[0],r=t[1];M(o),e=r,n=o._id,e.forEach((function(t){h.append(c(t,a,N,i,n))}))}))})();