(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e,n,o){return(n=function(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}var n=document.querySelector("#card-template").content;function o(t,o,r,c,i){var a=n.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__image"),s=a.querySelector(".card__title"),l=a.querySelector(".card__delete-button"),d=a.querySelector(".card__like"),f=d.querySelector(".card__like-button"),p=d.querySelector(".card__like-count");!function(t,e,n){n!==e&&t.remove()}(l,i,t.owner._id),function(t,e){e&&t.classList.add("card__like-button_is-active")}(f,function(t,e){return t.likes.some((function(t){return t._id===e}))}(t,i));var m=e(e(e({},u.classList[0],r),f.classList[0],o),l.classList[0],c);return u.src=t.link,u.alt=t.name,s.textContent=t.name,p.textContent=t.likes.length,a.addEventListener("click",(function(e){var n,o=m[e.target.classList[0]];o&&o({event:e,cardObject:t,likeCount:p,isLiked:(n=f,n.classList.contains("card__like-button_is-active"))})})),a}function r(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function c(t){var e=t.currentTarget;(t.target.classList.contains("popup__close")||e===t.target)&&a(e)}function i(t){"Escape"===t.key&&a(document.querySelector(".popup_is-opened"))}function a(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function u(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);!function(t,e,n){t.forEach((function(t){l(s(t.id),e,t,n)}))}(n,e.errorClass,e.inputErrorClass),d(o,e.inactiveButtonClass)}function s(t){return document.querySelector(".".concat(t,"-error"))}function l(t,e,n,o){n.classList.remove(o),t.classList.remove(e),t.textContent=""}function d(t,e){t.classList.add(e),t.disabled=!0}document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("click",c)}));var f={baseUrl:"https://nomoreparties.co/v1/wff-cohort-27",headers:{authorization:"df089792-a67d-41d5-b354-4cd03174c768","Content-Type":"application/json"}};function p(t){fetch(f.baseUrl+"/cards/".concat(t.cardObject._id),{method:"DELETE",headers:{authorization:f.headers.authorization}}).then((function(e){return e.ok&&t.event.target.closest(".card").remove(),Promise.reject("Ошибка: ".concat(e.status))})).catch((function(t){console.log(t)}))}function m(t){var e=t.cardObject._id,n=t.isLiked,o=t.likeCount,r=t.event.target;n?function(t,e,n){fetch(f.baseUrl+"/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:f.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){n.classList.remove("card__like-button_is-active"),e.textContent=t.likes.length})).catch((function(t){console.log(t)}))}(e,o,r):function(t,e,n){fetch(f.baseUrl+"/cards/likes/".concat(t),{method:"PUT",headers:{authorization:f.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){n.classList.add("card__like-button_is-active"),e.textContent=t.likes.length})).catch((function(t){console.log(t)}))}(e,o,r)}var _,v=[fetch(f.baseUrl+"/users/me",{headers:{authorization:f.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)})),fetch(f.baseUrl+"/cards",{headers:{authorization:f.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))],h=document.querySelector(".places__list"),y=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_new-card"),g=document.querySelector(".popup_type_image"),L=document.querySelector(".popup_type_avatar"),q=document.forms["new-place"],C=q["place-name"],E=q.link,j=document.forms["edit-profile"],x=j.name,P=j.description,z=document.forms.avatar,w=z.link,U=document.querySelector(".profile"),A=U.querySelector(".profile__image"),T=U.querySelector(".profile__info"),O=T.querySelector(".profile__title"),B=T.querySelector(".profile__description"),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function N(t){r(g);var e=g.querySelector(".popup__image"),n=g.querySelector(".popup__caption");e.src=t.event.target.src,n.textContent=t.event.target.alt}function J(t,e){O.textContent=t,B.textContent=e}function M(t){J(t.name,t.about),A.style.backgroundImage="url(".concat(t.avatar,")")}y.addEventListener("click",(function(){r(S),x.value=O.textContent,P.value=B.textContent,u(j,D)})),b.addEventListener("click",(function(){r(k)})),A.addEventListener("click",(function(){r(L)})),j.addEventListener("submit",(function(t){var e,n,o;t.preventDefault(),e=x.value,n=P.value,o=J,fetch(f.baseUrl+"/users/me",{method:"PATCH",headers:f.headers,body:JSON.stringify({name:e,about:n})}).then((function(t){if(t.ok)return t.json()})).then((function(t){o(t.name,t.about)})),a(S)})),q.addEventListener("submit",(function(t){t.preventDefault();var e,n,r=t.target.querySelector(".popup__button");r.textContent="Сохранение...",(e=C.value,n=E.value,fetch(f.baseUrl+"/cards",{method:"POST",headers:f.headers,body:JSON.stringify({name:e,link:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))).then((function(t){h.prepend(o(t,m,N,p,t.owner._id)),r.textContent="Сохранить"})),q.reset(),u(q,D),a(k)})),z.addEventListener("submit",(function(t){t.preventDefault();var e,n=t.target.querySelector(".popup__button");n.textContent="Сохранение...",(e=w.value,fetch(f.baseUrl+"/users/me/avatar",{method:"PATCH",headers:f.headers,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))).then((function(t){M(t),n.textContent="Сохранить"})),a(L),z.reset()})),_=D,Array.from(document.querySelectorAll(_.formSelector)).forEach((function(t){var e=Array.from(t.querySelectorAll(_.inputSelector)),n=t.querySelector(_.submitButtonSelector);e.forEach((function(t){t.addEventListener("input",(function(o){o.preventDefault(),function(t,e,n){var o=s(t.id),r=function(t){return t.validity.patternMismatch?t.dataset.invalidMessage:t.validationMessage}(t);console.log(n),t.validity.valid?l(o,n,t,e):function(t,e,n,o,r){o.classList.add(r),t.classList.add(n),t.textContent=e}(o,r,n,t,e)}(t,_.inputErrorClass,_.errorClass),function(t,e,n,o){var r=function(t,e){return!t.some((function(t){return t.classList.contains(e)}))}(e,o);r?function(t,e){t.classList.remove(e),t.disabled=!1}(t,n):d(t,n)}(n,e,_.inactiveButtonClass,_.inputErrorClass)}))}))})),Promise.all(v).then((function(t){var e,n,r=t[0],c=t[1];M(r),e=c,n=r._id,e.forEach((function(t){h.append(o(t,m,N,p,n))}))}))})();